{
  "version": "1.0",
  "description": "Broker API reference for GPT-Trader",
  "protocols": {
    "BrokerProtocol": {
      "description": "Core protocol for broker implementations. Defines the minimal interface required for trading operations.",
      "implemented_by": [
        "CoinbaseRestService",
        "DeterministicBroker"
      ],
      "methods": {
        "cancel_order": {
          "docstring": "Cancel an existing order.",
          "parameters": {
            "order_id": {
              "type": "str",
              "required": true
            }
          },
          "returns": "bool"
        },
        "get_candles": {
          "docstring": "Get historical candle data.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            },
            "kwargs": {
              "type": "Any",
              "required": true
            }
          },
          "returns": "list[Candle]"
        },
        "get_product": {
          "docstring": "Get product metadata for a symbol.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            }
          },
          "returns": "Product | None"
        },
        "get_quote": {
          "docstring": "Get current quote for a symbol.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            }
          },
          "returns": "Quote | None"
        },
        "get_ticker": {
          "docstring": "Get ticker data for a product.",
          "parameters": {
            "product_id": {
              "type": "str",
              "required": true
            }
          },
          "returns": "dict[str, Any]"
        },
        "list_balances": {
          "docstring": "List all account balances.",
          "parameters": {},
          "returns": "list[Balance]"
        },
        "list_positions": {
          "docstring": "List all current positions.",
          "parameters": {},
          "returns": "list[Position]"
        },
        "place_order": {
          "docstring": "Place a trading order.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            },
            "side": {
              "type": "Any",
              "default": null,
              "required": false
            },
            "order_type": {
              "type": "Any",
              "default": null,
              "required": false
            },
            "quantity": {
              "type": "Decimal | None",
              "default": null,
              "required": false
            },
            "kwargs": {
              "type": "Any",
              "required": true
            }
          },
          "returns": "Order"
        }
      }
    },
    "ExtendedBrokerProtocol": {
      "description": "Extended broker protocol with additional methods for mark price tracking and position risk.",
      "extends": "BrokerProtocol",
      "additional_methods": {
        "get_mark_price": {
          "docstring": "Get current mark price for a symbol.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            }
          },
          "returns": "Decimal | None"
        },
        "get_market_snapshot": {
          "docstring": "Get a snapshot of market data for a symbol.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            }
          },
          "returns": "dict[str, Any]"
        },
        "get_position_pnl": {
          "docstring": "Get PnL data for a position.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            }
          },
          "returns": "dict[str, Decimal]"
        },
        "get_position_risk": {
          "docstring": "Get risk metrics for a position.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            }
          },
          "returns": "dict[str, Any]"
        }
      }
    },
    "MarketDataProtocol": {
      "description": "Protocol for market data streaming subscriptions.",
      "methods": {
        "is_connected": {
          "docstring": "Check if market data connection is active.",
          "parameters": {},
          "returns": "bool"
        },
        "is_stale": {
          "docstring": "Check if market data for a symbol is stale.",
          "parameters": {
            "symbol": {
              "type": "str",
              "required": true
            },
            "threshold_seconds": {
              "type": "int",
              "default": 10,
              "required": false
            }
          },
          "returns": "bool"
        },
        "start_market_data": {
          "docstring": "Start streaming market data for symbols.",
          "parameters": {
            "symbols": {
              "type": "list[str]",
              "required": true
            }
          },
          "returns": "None"
        },
        "stop_market_data": {
          "docstring": "Stop streaming market data.",
          "parameters": {},
          "returns": "None"
        }
      }
    }
  },
  "errors": {
    "InvalidRequestError": {
      "description": "Request parameters are invalid",
      "causes": [
        "Invalid symbol format",
        "Quantity below minimum",
        "Price outside valid range"
      ],
      "handling": "Validate inputs before calling broker methods"
    },
    "InsufficientFunds": {
      "description": "Not enough balance to execute order",
      "causes": [
        "Available balance less than order value",
        "Funds on hold for other orders"
      ],
      "handling": "Check available balance before placing orders"
    },
    "NotFoundError": {
      "description": "Requested resource not found",
      "causes": [
        "Invalid order ID",
        "Unknown symbol"
      ],
      "handling": "Verify resource exists before operations"
    },
    "AuthError": {
      "description": "Authentication failed",
      "causes": [
        "Invalid API credentials",
        "Expired token",
        "Missing permissions"
      ],
      "handling": "Check credentials and permissions"
    },
    "RateLimitError": {
      "description": "API rate limit exceeded",
      "causes": [
        "Too many requests in time window"
      ],
      "handling": "Implement exponential backoff retry"
    }
  }
}
