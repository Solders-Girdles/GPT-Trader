/* Main Stylesheet - GPT-Trader TUI
 *
 * Theme: Claude Code-inspired warm, editorial aesthetic
 * Palette: Rust-orange accent (#C15F3C) with warm browns and parchment tones
 *
 * This stylesheet combines all TUI styling modules:
 * 1. Theme variables (colors and spacing)
 * 2. Layout structure
 * 3. Core components
 * 4. Widget-specific styles
 * 5. Animations and transitions
 */

/* ========================================================================== */
/* THEME VARIABLES - Claude Code Palette                                     */
/* ========================================================================== */

/* === Backgrounds === */
$bg-primary: #1A1815;      /* Deep warm brown "coffee stain" - main background */
$bg-secondary: #2A2520;    /* CHANGED: Lighter warm brown - containers (was #2E2922) */
$bg-elevated: #3D3833;     /* CHANGED: Elevated surfaces (was #3A3530) */

/* === Accents === */
$accent: #D4744F;          /* CHANGED: Brighter rust-orange (was #C15F3C) */
$accent-hover: #E08A6A;    /* CHANGED: Lighter rust - hover states (was #D17A5A) */
$accent-muted: #9B5338;    /* CHANGED: Darker rust (was #8B4428) */

/* === Text Colors === */
$text-primary: #F0EDE9;    /* CHANGED: Increased brightness (was #E8E6E3) */
$text-secondary: #B8B5B2;  /* CHANGED: Increased contrast (was #ABA8A5) */
$text-muted: #7A7672;      /* CHANGED: Slightly lighter (was #6B6865) */

/* === Semantic Colors === */
$success: #85B77F;         /* CHANGED: Brighter green (was #7AA874) */
$warning: #E0B366;         /* CHANGED: More vibrant amber (was #D8A657) */
$error: #E08580;           /* CHANGED: Brighter coral-red (was #D4736E) */
$info: #7FB8D4;            /* CHANGED: Brighter blue-grey (was #6FA8C4) */

/* === Borders === */
$border-subtle: #3D3833;   /* CHANGED: Match bg-elevated (was #3A3530) */

/* === Spacing Scale === */
$spacing-xs: 1;            /* Extra small spacing - tight elements */
$spacing-sm: 2;            /* Small spacing - compact layouts */
$spacing-md: 3;            /* Medium spacing - standard padding */
$spacing-lg: 4;            /* Large spacing - generous padding */

/* === Semantic Spacing Tokens (8-cell grid) === */
$gutter-tight: 1;          /* Column/panel gaps in compact mode */
$gutter-standard: 2;       /* Default column/panel gutters */
$gutter-comfortable: 4;    /* Wide mode gutters */
$content-padding: 2;       /* Padding inside panels/widgets */
$section-gap: 4;           /* Spacing between major UI sections */

/* === Interactive State Overlays === */
$overlay-hover: rgba(193, 95, 60, 0.1);    /* 10% accent on hover */
$overlay-focus: rgba(193, 95, 60, 0.2);    /* 20% accent on focus */
$overlay-disabled: rgba(58, 53, 48, 0.5);  /* 50% muted for disabled */

/* === Panel Tokens === */
$panel-bg-default: $bg-secondary;
$panel-bg-elevated: $bg-elevated;
$panel-border-default: $border-subtle;
$panel-border-emphasis: $accent;

/* === Interactive State Tokens === */
$interactive-default: $bg-elevated;
$interactive-hover: $accent-muted;
$interactive-active: $accent;
$interactive-disabled: $bg-secondary;

/* === Border Style Tokens === */
$border-default: solid $border-subtle;
$border-emphasis: thick $accent;

/* ========================================================================== */
/* FOCUS INDICATORS (Accessibility)                                           */
/* ========================================================================== */

/* Global focus indicator - bright accent border */
*:focus {
    border: thick $accent;
    border-title-color: $accent;
}

/* DataTable focus - highlight selected row */
DataTable:focus {
    border: thick $accent;
}

DataTable > .datatable--cursor {
    background: $overlay-focus;  /* Subtle highlight for cursor row */
}

DataTable:focus > .datatable--cursor {
    background: rgba(212, 116, 79, 0.3);  /* Stronger highlight when focused */
    color: $text-primary;
}

/* TabbedContent focus - highlight active tab */
TabbedContent:focus Tab.-active {
    border: solid $accent;
    text-style: bold;
}

/* Input/Select focus - bright border */
Input:focus, Select:focus {
    border: thick $accent;
}

/* ========================================================================== */
/* LAYOUT PATTERNS                                                            */
/* ========================================================================== */

/* === Global Layout === */

Screen {
    layout: vertical;
    background: $bg-primary;
    color: $text-primary;
}

Label {
    color: $text-primary;
}

/* === Main Workspace - Now horizontal split (30/70) === */

#main-workspace {
    layout: horizontal;  /* Changed from vertical */
    height: 100%;
}

/* === Left Column: Market + Strategy (30% width) === */

#market-strategy-column {
    width: 30%;
    height: 100%;
    layout: vertical;
    border-right: solid $border-subtle;  /* CHANGED from wide to solid */
}

#dash-market {
    height: 1fr;           /* Flex-grow to fill available space */
}

#dash-strategy {
    height: auto;          /* Shrink to content */
    max-height: 30%;       /* Cap at 30% to prevent domination */
    min-height: 5;         /* Minimum 5 lines (header + empty state) */
}

/* === Responsive Column Ratios === */
/* Applied via Python reactive properties based on terminal width */

/* Compact (100-119 cols): Wider left for more ticker visibility */
.workspace--compact #market-strategy-column {
    width: 35%;
}

.workspace--compact #execution-monitoring-column {
    width: 65%;
}

/* Standard (120-139 cols): Slightly narrower left */
.workspace--standard #market-strategy-column {
    width: 32%;
}

.workspace--standard #execution-monitoring-column {
    width: 68%;
}

/* Comfortable (140-159 cols): Default balanced split */
.workspace--comfortable #market-strategy-column {
    width: 30%;
}

.workspace--comfortable #execution-monitoring-column {
    width: 70%;
}

/* Wide (160+ cols): More space for execution monitoring */
.workspace--wide #market-strategy-column {
    width: 25%;
}

.workspace--wide #execution-monitoring-column {
    width: 75%;
}

/* === Right Column: Execution + Monitoring (70% width) === */

#execution-monitoring-column {
    width: 70%;
    height: 100%;
    layout: vertical;
}

#dash-portfolio {
    height: auto;          /* Shrink to content */
    max-height: 50%;       /* Cap at 50% (was 40% + 40% = 80% for two widgets) */
    min-height: 8;         /* Minimum 8 lines (header + tabs + content) */
}

/* === Portfolio Widget (Tabbed Layout) === */

PortfolioWidget {
    layout: vertical;
    height: 1fr;
}

PortfolioWidget TabbedContent {
    height: 1fr;
    border: none;
}

PortfolioWidget TabPane {
    padding: 0;
}

/* === Monitoring Row (flex-grow to fill remaining space after portfolio) === */

#monitoring-row {
    layout: horizontal;  /* Side-by-side: System Health + Logs */
    height: 1fr;  /* Take all remaining space - expands when portfolio shrinks */
    min-height: 10;  /* Ensure at least 10 lines visible */
}

#dash-system-health {
    width: 40%;
    height: 1fr;
    border-right: solid $border-subtle;  /* Visual separator */
}

#dash-logs {
    width: 60%;
    height: 1fr;  /* Take monitoring row space */
}

/* === Dashboard Items === */

.dashboard-item {
    layout: vertical;
    /* height controlled by specific ID selectors above */
    /* NOTE: No height: 1fr here - specific IDs control their own heights */
    /* Each widget has min-height set to prevent collapse on short terminals: */
    /*   #dash-portfolio: min-height: 8   (header + tabs + content)       */
    /*   #monitoring-row: min-height: 10  (log panel expansion)           */
    border: none;                      /* REMOVED: full border */
    border-top: solid $border-subtle;  /* Only top border for separation */
    background: $bg-secondary;
    padding: 0;  /* Remove padding to prevent header clipping */
    margin: 0;   /* REMOVED: horizontal margin */
}

.dashboard-item-elevated {
    background: $bg-elevated;
}

/* === Compact Logs Styling === */

.compact-logs {
    /* Compressed log display in monitoring row */
}

.log-expand-hint {
    color: $text-muted;
    text-style: italic;
    text-align: center;
    padding: 0 $spacing-xs;
}

/* === Panel Style === */

.panel {
    background: $bg-secondary;
    border: round $border-subtle;
    padding: $spacing-md;
    margin: $spacing-xs;
}

/* ========================================================================== */
/* CORE COMPONENT STYLES                                                      */
/* ========================================================================== */

/* === Headers & Footers === */

Header {
    dock: top;
    height: 1;
    background: $bg-secondary;
    color: $text-primary;
}

Footer {
    dock: bottom;
    height: 1;
    background: $bg-secondary;
    color: $text-primary;
}

/* === Widget Headers === */

.header {
    color: #FFFFFF;                    /* CHANGED: Pure white for maximum contrast */
    text-style: bold;                  /* CHANGED: Bold for emphasis and readability */
    text-align: left;                  /* Left-aligned editorial style */
    background: $bg-elevated;          /* Elevated surface for separation */
    padding: 0 2;                      /* Compact horizontal padding */
    border-left: thick $accent;        /* ADDED: Accent left border for visual hierarchy */
    border-bottom: none;               /* No bottom border */
    height: 1;                         /* Single line */
    content-align: left middle;        /* Vertically center the text */
}

.header-icon {
    color: $accent;
    margin-right: $spacing-xs;
}

/* === Buttons === */

Button {
    min-width: 10;  /* Compact width */
    height: 3;      /* Restored from 1 to 3 for readability */
    margin: 0 $spacing-xs;
    border: $border-default;  /* Restored border for visual separation */
    padding: 0 $spacing-md;
    background: $bg-elevated;
    color: $text-primary;
    text-style: bold;
}

Button:hover {
    border: solid $accent;  /* Restored border for hover state */
    background: $accent-muted;
    color: $text-primary;
}

Button:focus {
    border: solid $accent;  /* Restored border for focus state */
    background: $accent;
    color: $bg-primary;
}

Button.-disabled {
    opacity: 0.5;
    color: $text-muted;
    border: solid $border-subtle;
}

/* === Control Buttons (Start/Stop) === */

#start-btn {
    background: $success;
    color: $bg-primary;
    border-left: wide $success;
}

#start-btn:hover {
    background: $success;
    color: $bg-primary;
    border: solid $success;  /* Restored border for consistency */
    text-style: bold;
}

#stop-btn {
    background: $error;
    color: $bg-primary;
    border-left: wide $error;
}

#stop-btn:hover {
    background: $error;
    color: $bg-primary;
    border: solid $error;  /* Restored border for consistency */
    text-style: bold;
}

/* === DataTable === */

DataTable {
    background: $bg-primary;
    color: $text-primary;
    border: none;
    padding: 0 1;                  /* REDUCED from $spacing-md - tighter padding */
    /* height controlled by individual widgets via DEFAULT_CSS */
}

DataTable > .datatable--header {
    background: $bg-elevated;
    color: #FFFFFF;                /* CHANGED: Pure white for maximum contrast */
    text-style: bold;              /* CHANGED: Bold headers for emphasis */
    padding: $spacing-xs $content-padding;
    border-bottom: $border-default;
}

/* Column separators for better readability */
/* Note: Textual doesn't support :last-child, so all columns get separators */
DataTable > .datatable--header-cell {
    border-right: $border-default;
}

DataTable > .datatable--cell {
    border-right: $border-default;
    padding: 0 $content-padding;
    overflow: hidden;
    /* Note: Textual doesn't support text-overflow: ellipsis */
}

DataTable > .datatable--cursor {
    background: $accent-muted;
    color: $text-primary;
    text-style: bold;
}

DataTable > .datatable--odd-row {
    background: $bg-primary;
}

DataTable > .datatable--even-row {
    background: rgba(58, 53, 48, 0.15);  /* CHANGED to 0.15 - more subtle zebra striping */
}

DataTable:focus > .datatable--cursor {
    background: $accent;
    color: $bg-primary;
    text-style: bold;
}

/* Row hover effect */
DataTable > .datatable--hover {
    background: rgba(193, 95, 60, 0.15);  /* Subtle accent tint on hover */
}

/* === Tabs === */

Tabs {
    background: $bg-secondary;
    color: $text-primary;
    dock: top;
    height: 3;
}

Tab {
    padding: $spacing-xs $spacing-md;
}

Tab.-active {
    background: $bg-elevated;
    color: $accent;
    text-style: bold;
    border-bottom: solid $accent;
}

/* === Content Areas === */

ContentSwitcher {
    background: $bg-primary;
    height: 1fr;
}

#dashboard-container, #market-container, #positions-container, #system-container {
    padding: $spacing-xs;
    height: 1fr;
}

/* === Empty States === */

.empty-state {
    height: 1;              /* Single line */
    border: none;           /* No dashed border */
    background: transparent;
    padding: 0 2;
    margin: 0;
    color: $text-muted;
    text-style: italic;
    text-align: center;
    display: none;  /* Hidden by default */
}

/* === Log Widget === */

Log {
    background: $bg-secondary;
    color: $text-primary;
    border: solid $border-subtle;
    padding: 0 $spacing-xs;
}

/* === Typography Utilities === */

.text-success { color: $success; }
.text-error { color: $error; }
.text-warning { color: $warning; }
.text-info { color: $info; }
.text-muted { color: $text-muted; }

.bold { text-style: bold; }

/* Numeric alignment for DataTable cells */
.text-numeric {
    text-align: right;
}

/* === Accessibility === */

/* Focus indicators for keyboard navigation */
*:focus {
    border: solid $accent;
    outline: solid $accent;
}

DataTable:focus {
    border: solid $accent;
}

/* ========================================================================== */
/* WIDGET-SPECIFIC STYLES                                                     */
/* ========================================================================== */

/* === Status Bar (BotStatusWidget) === */

#bot-status-header {
    height: 3;                     /* Compact to maximize space for data panels */
    background: $bg-secondary;
    color: $text-primary;
    border-bottom: solid $accent;   /* CHANGED: double -> solid */
    padding: 0;
}

#status-bar-container {
    height: 100%;
    align-vertical: middle;
}

.status-section {
    padding: 0 $spacing-md;
    height: 100%;
    align-vertical: middle;
}

#bot-controls {
    width: 2fr;  /* Expanded to accommodate mode controls */
    border-right: solid $border-subtle;
}

#status-info {
    width: 1fr;
    border-right: solid $border-subtle;
}

#performance-metrics {
    width: auto;
    border-right: solid $border-subtle;
}

#system-health-section {
    width: auto;
}

.status-row {
    height: auto;           /* Changed from 1 to auto for flexible content */
    align-vertical: middle;
    margin-bottom: 0;
}

/* === Status Labels & Values === */

.status-label {
    color: $text-secondary;
    text-style: bold;
    margin-right: $spacing-xs;
}

.status-value {
    color: $text-primary;
    text-style: bold;
    margin-right: $spacing-md;
    background: $bg-elevated;
    padding: 0 $spacing-md;
    border: solid $border-subtle;
}

.status-running {
    color: $success;
    background: rgba(122, 168, 116, 0.2);
    padding: 0 $spacing-md;
    border: solid $success;
}

.status-stopped {
    color: $error;
    background: rgba(212, 115, 110, 0.2);
    padding: 0 $spacing-md;
    border: solid $error;
}

/* === Connection Status Indicators === */

.status-connected {
    color: $success;
}

.status-disconnected {
    color: $error;
}

.status-unknown {
    color: $warning;
}

/* === Heartbeat Indicator === */

.heartbeat-pulse {
    margin-left: $spacing-xs;
}

.heartbeat-bright {
    color: $success;
    text-style: bold;
}

.heartbeat-dim {
    color: $text-muted;
}

/* === P&L Color Coding === */

.pnl-positive {
    color: $success;
}

.pnl-negative {
    color: $error;
}

.pnl-neutral {
    color: $text-secondary;
}

/* === Button Group === */

.button-group {
    align-vertical: middle;
    height: 100%;
}

/* === Mode Controls Row === */

/* === Compact Mode Controls === */

.mode-controls-compact {
    height: auto;
    align-vertical: middle;
    margin-right: $spacing-md;
    border-right: solid $border-subtle;
    padding-right: $spacing-md;
}

/* Compact mode indicator */
#mode-indicator {
    width: auto;
    height: 1;
    margin-right: $spacing-xs;
}

/* Compact mode selector */
#mode-selector {
    width: 20;
    height: 1;
}

/* === Contextual Footer === */

ContextualFooter {
    dock: bottom;
    height: 1;
    background: $bg-secondary;
    border-top: solid $accent;      /* CHANGED: double -> solid */
}

#contextual-footer {
    height: 100%;
    align-vertical: middle;
    padding: 0 $spacing-md;
}

.footer-group {
    margin-right: $spacing-md;
    align-vertical: middle;
}

.footer-group-right {
    dock: right;
}

.footer-key {
    color: $bg-primary;
    text-style: bold;
    background: $accent;
    padding: 0 $spacing-md;
    margin-right: $spacing-xs;
}

.footer-label {
    color: $text-primary;
    margin-right: $spacing-md;  /* More spacing between groups */
}

.footer-separator {
    color: $border-subtle;
    margin: 0 $spacing-xs;
}

/* === Account Widget === */

AccountWidget {
    layout: vertical;
    padding: $spacing-xs;
    /* height controlled by widget DEFAULT_CSS */
}

.account-metric {
    background: $bg-elevated;
    border: solid $border-subtle;
    padding: $spacing-xs $spacing-md;
    margin: $spacing-xs;
    height: auto;
}

.account-metric-label {
    color: $text-secondary;
    text-style: bold;
}

.account-metric-value {
    color: $text-primary;
    text-style: bold;
    text-align: right;
}

.portfolio-summary-row {
    margin-bottom: $spacing-sm;
}

.portfolio-metric {
    background: $bg-elevated;
    border: solid $border-subtle;
    padding: $spacing-xs $spacing-md;
    margin: $spacing-xs;
}

.portfolio-metric-label {
    color: $text-secondary;
    text-style: bold;
}

.portfolio-metric-value {
    color: $text-primary;
    text-style: bold;
}

.account-metrics-row {
    margin-bottom: $spacing-sm;
}

/* ========================================================================== */
/* ANIMATIONS & TRANSITIONS                                                   */
/* ========================================================================== */

/* Note: Textual has limited transition support
 * Animations are handled via Python update intervals
 */

/* === Loading Spinner === */

/* Note: Unicode Braille spinner (⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏) is animated via Python interval,
 * not CSS animations, for reliable terminal rendering.
 */

LoadingSpinner {
    width: auto;
    height: auto;
    align-horizontal: center;
    align-vertical: middle;
}

#spinner-display {
    color: $accent;
    text-style: bold;
    text-align: center;
}

.loading-spinner {
    color: $accent;
    text-style: bold;
    text-align: center;
}

.loading-message {
    color: $text-secondary;
    text-align: center;
    margin-top: $spacing-xs;
}

.loading-container {
    padding: $spacing-lg;
    background: rgba(58, 53, 48, 0.2);
    border: solid $border-subtle;
    align-horizontal: center;
    align-vertical: middle;
}

/* Note: Textual doesn't support @keyframes or @media queries
 * Advanced animations and media queries must be implemented in Python
 */

/* ========================================================================== */
/* MODE SELECTION SCREEN                                                      */
/* ========================================================================== */

ModeSelectionScreen {
    align: center middle;
    background: $bg-primary;
}

#mode-selection-container {
    width: 80;
    height: auto;
    background: $bg-secondary;
    border: solid $accent;
    padding: 2;
    align: center middle;
}

#selection-title {
    text-align: center;
    text-style: bold;
    color: $accent;
    width: 100%;
    margin-bottom: 2;
}

#selection-subtitle {
    text-align: center;
    color: $text-secondary;
    width: 100%;
    margin-bottom: 3;
}

.mode-option {
    width: 100%;
    height: auto;
    background: $bg-elevated;
    border: solid $border-subtle;
    padding: 1 2;
    margin: 1 0;
}

.mode-option:hover {
    border: solid $accent;
    background: $accent-muted;
}

.mode-option-header {
    text-style: bold;
    color: $text-primary;
    margin-bottom: 1;
}

.mode-option-description {
    color: $text-secondary;
    margin-left: 2;
}

.mode-demo {
    border-left: wide $info;
}

.mode-paper {
    border-left: wide $success;
}

.mode-observe {
    border-left: wide $warning;
}

.mode-live {
    border-left: wide $error;
}

#quit-button {
    width: 100%;
    margin-top: 2;
}
