{
  "artifact": "market_data_flow_map",
  "description": "Market data flow map (REST polling + WS streaming).",
  "clusters": [
    {
      "id": "polling",
      "label": "REST Polling"
    },
    {
      "id": "streaming",
      "label": "WebSocket Streaming"
    },
    {
      "id": "state",
      "label": "Runtime State"
    },
    {
      "id": "risk",
      "label": "Risk + Staleness"
    },
    {
      "id": "event_store",
      "label": "Event Store"
    },
    {
      "id": "strategy",
      "label": "Strategy Inputs"
    }
  ],
  "nodes": [
    {
      "id": "engine_cycle",
      "label": "TradingEngine._cycle",
      "type": "entrypoint",
      "path": "src/gpt_trader/features/live_trade/engines/strategy.py",
      "cluster": "polling"
    },
    {
      "id": "fetch_batch_tickers",
      "label": "TradingEngine._fetch_batch_tickers",
      "type": "fetch",
      "path": "src/gpt_trader/features/live_trade/engines/strategy.py",
      "cluster": "polling"
    },
    {
      "id": "broker_get_tickers",
      "label": "Broker.get_tickers (optional)",
      "type": "broker",
      "path": "src/gpt_trader/features/brokerages/coinbase/rest/product_service.py",
      "cluster": "polling"
    },
    {
      "id": "broker_get_ticker",
      "label": "BrokerProtocol.get_ticker",
      "type": "broker",
      "path": "src/gpt_trader/features/brokerages/core/protocols.py",
      "cluster": "polling"
    },
    {
      "id": "broker_get_candles",
      "label": "BrokerProtocol.get_candles",
      "type": "broker",
      "path": "src/gpt_trader/features/brokerages/core/protocols.py",
      "cluster": "polling"
    },
    {
      "id": "process_symbol",
      "label": "TradingEngine._process_symbol",
      "type": "processing",
      "path": "src/gpt_trader/features/live_trade/engines/strategy.py",
      "cluster": "polling"
    },
    {
      "id": "start_streaming",
      "label": "start_streaming_background",
      "type": "stream",
      "path": "src/gpt_trader/features/live_trade/engines/telemetry_streaming.py",
      "cluster": "streaming"
    },
    {
      "id": "run_stream_loop",
      "label": "telemetry_streaming._run_stream_loop",
      "type": "stream",
      "path": "src/gpt_trader/features/live_trade/engines/telemetry_streaming.py",
      "cluster": "streaming"
    },
    {
      "id": "stream_orderbook",
      "label": "WebSocketClientMixin.stream_orderbook",
      "type": "stream",
      "path": "src/gpt_trader/features/brokerages/coinbase/client/websocket_mixin.py",
      "cluster": "streaming"
    },
    {
      "id": "stream_trades",
      "label": "WebSocketClientMixin.stream_trades",
      "type": "stream",
      "path": "src/gpt_trader/features/brokerages/coinbase/client/websocket_mixin.py",
      "cluster": "streaming"
    },
    {
      "id": "ws_events",
      "label": "ws_events (OrderbookUpdate/TradeEvent)",
      "type": "parser",
      "path": "src/gpt_trader/features/brokerages/coinbase/ws_events.py",
      "cluster": "streaming"
    },
    {
      "id": "update_mark_metrics",
      "label": "update_mark_and_metrics",
      "type": "stream_update",
      "path": "src/gpt_trader/features/live_trade/engines/telemetry_health.py",
      "cluster": "streaming"
    },
    {
      "id": "update_orderbook_snapshot",
      "label": "update_orderbook_snapshot",
      "type": "stream_update",
      "path": "src/gpt_trader/features/live_trade/engines/telemetry_health.py",
      "cluster": "streaming"
    },
    {
      "id": "update_trade_aggregator",
      "label": "update_trade_aggregator",
      "type": "stream_update",
      "path": "src/gpt_trader/features/live_trade/engines/telemetry_health.py",
      "cluster": "streaming"
    },
    {
      "id": "price_tick_store",
      "label": "PriceTickStore",
      "type": "state",
      "path": "src/gpt_trader/features/live_trade/engines/price_tick_store.py",
      "cluster": "state"
    },
    {
      "id": "runtime_mark_windows",
      "label": "RuntimeStateProtocol.mark_windows",
      "type": "state",
      "path": "src/gpt_trader/app/protocols.py",
      "cluster": "state"
    },
    {
      "id": "runtime_orderbook_snapshots",
      "label": "RuntimeStateProtocol.orderbook_snapshots",
      "type": "state",
      "path": "src/gpt_trader/app/protocols.py",
      "cluster": "state"
    },
    {
      "id": "runtime_trade_aggregators",
      "label": "RuntimeStateProtocol.trade_aggregators",
      "type": "state",
      "path": "src/gpt_trader/app/protocols.py",
      "cluster": "state"
    },
    {
      "id": "risk_last_mark_update",
      "label": "LiveRiskManager.last_mark_update",
      "type": "risk_state",
      "path": "src/gpt_trader/features/live_trade/risk/manager/__init__.py",
      "cluster": "risk"
    },
    {
      "id": "risk_check_mark_staleness",
      "label": "LiveRiskManager.check_mark_staleness",
      "type": "risk_check",
      "path": "src/gpt_trader/features/live_trade/risk/manager/__init__.py",
      "cluster": "risk"
    },
    {
      "id": "emit_metric",
      "label": "emit_metric",
      "type": "telemetry",
      "path": "src/gpt_trader/utilities/telemetry.py",
      "cluster": "event_store"
    },
    {
      "id": "emit_orderbook_snapshot",
      "label": "emit_orderbook_snapshot",
      "type": "telemetry",
      "path": "src/gpt_trader/features/live_trade/engines/telemetry_health.py",
      "cluster": "event_store"
    },
    {
      "id": "emit_trade_flow_summary",
      "label": "emit_trade_flow_summary",
      "type": "telemetry",
      "path": "src/gpt_trader/features/live_trade/engines/telemetry_health.py",
      "cluster": "event_store"
    },
    {
      "id": "event_store_append_metric",
      "label": "EventStoreProtocol.append_metric",
      "type": "event_store",
      "path": "src/gpt_trader/app/protocols.py",
      "cluster": "event_store"
    },
    {
      "id": "event_store_append",
      "label": "EventStoreProtocol.append",
      "type": "event_store",
      "path": "src/gpt_trader/app/protocols.py",
      "cluster": "event_store"
    },
    {
      "id": "strategy_orchestrator",
      "label": "StrategyOrchestrator.process_symbol",
      "type": "entrypoint",
      "path": "src/gpt_trader/features/live_trade/orchestrator/orchestrator.py",
      "cluster": "strategy"
    },
    {
      "id": "context_builder",
      "label": "ContextBuilderMixin._prepare_context",
      "type": "context",
      "path": "src/gpt_trader/features/live_trade/orchestrator/context.py",
      "cluster": "strategy"
    },
    {
      "id": "market_data_context",
      "label": "MarketDataContext",
      "type": "context",
      "path": "src/gpt_trader/features/live_trade/strategies/base.py",
      "cluster": "strategy"
    },
    {
      "id": "decision_engine",
      "label": "DecisionEngineMixin._resolve_decision",
      "type": "decision",
      "path": "src/gpt_trader/features/live_trade/orchestrator/decision.py",
      "cluster": "strategy"
    },
    {
      "id": "strategy_decide",
      "label": "Strategy.decide",
      "type": "decision",
      "path": "src/gpt_trader/features/live_trade/strategies/base.py",
      "cluster": "strategy"
    }
  ],
  "edges": [
    {
      "from": "engine_cycle",
      "to": "fetch_batch_tickers",
      "label": "poll tickers"
    },
    {
      "from": "fetch_batch_tickers",
      "to": "broker_get_tickers",
      "label": "batch request"
    },
    {
      "from": "fetch_batch_tickers",
      "to": "broker_get_ticker",
      "label": "fallback per symbol"
    },
    {
      "from": "broker_get_tickers",
      "to": "process_symbol",
      "label": "ticker map"
    },
    {
      "from": "broker_get_ticker",
      "to": "process_symbol",
      "label": "single ticker"
    },
    {
      "from": "process_symbol",
      "to": "broker_get_candles",
      "label": "candles request"
    },
    {
      "from": "broker_get_candles",
      "to": "process_symbol",
      "label": "candles data"
    },
    {
      "from": "process_symbol",
      "to": "price_tick_store",
      "label": "record mark"
    },
    {
      "from": "process_symbol",
      "to": "risk_last_mark_update",
      "label": "mark timestamp"
    },
    {
      "from": "price_tick_store",
      "to": "strategy_decide",
      "label": "recent_marks"
    },
    {
      "from": "process_symbol",
      "to": "strategy_decide",
      "label": "current_mark + candles"
    },
    {
      "from": "start_streaming",
      "to": "run_stream_loop",
      "label": "start WS loop"
    },
    {
      "from": "run_stream_loop",
      "to": "stream_orderbook",
      "label": "primary stream"
    },
    {
      "from": "run_stream_loop",
      "to": "stream_trades",
      "label": "fallback stream"
    },
    {
      "from": "stream_orderbook",
      "to": "ws_events",
      "label": "messages"
    },
    {
      "from": "stream_trades",
      "to": "ws_events",
      "label": "messages"
    },
    {
      "from": "ws_events",
      "to": "update_mark_metrics",
      "label": "mark updates"
    },
    {
      "from": "ws_events",
      "to": "update_orderbook_snapshot",
      "label": "orderbook updates"
    },
    {
      "from": "ws_events",
      "to": "update_trade_aggregator",
      "label": "trade updates"
    },
    {
      "from": "update_mark_metrics",
      "to": "runtime_mark_windows",
      "label": "mark windows"
    },
    {
      "from": "update_mark_metrics",
      "to": "risk_last_mark_update",
      "label": "mark timestamp"
    },
    {
      "from": "update_mark_metrics",
      "to": "emit_metric",
      "label": "ws_mark_update"
    },
    {
      "from": "update_orderbook_snapshot",
      "to": "runtime_orderbook_snapshots",
      "label": "depth snapshot"
    },
    {
      "from": "update_orderbook_snapshot",
      "to": "emit_orderbook_snapshot",
      "label": "persist snapshot"
    },
    {
      "from": "update_trade_aggregator",
      "to": "runtime_trade_aggregators",
      "label": "trade stats"
    },
    {
      "from": "update_trade_aggregator",
      "to": "emit_trade_flow_summary",
      "label": "persist trade flow"
    },
    {
      "from": "run_stream_loop",
      "to": "emit_metric",
      "label": "stream health"
    },
    {
      "from": "emit_metric",
      "to": "event_store_append_metric",
      "label": "append_metric"
    },
    {
      "from": "emit_orderbook_snapshot",
      "to": "event_store_append",
      "label": "append orderbook"
    },
    {
      "from": "emit_trade_flow_summary",
      "to": "event_store_append",
      "label": "append trade flow"
    },
    {
      "from": "risk_last_mark_update",
      "to": "risk_check_mark_staleness",
      "label": "staleness input"
    },
    {
      "from": "runtime_mark_windows",
      "to": "context_builder",
      "label": "marks"
    },
    {
      "from": "runtime_orderbook_snapshots",
      "to": "context_builder",
      "label": "orderbook"
    },
    {
      "from": "runtime_trade_aggregators",
      "to": "context_builder",
      "label": "trade stats"
    },
    {
      "from": "risk_check_mark_staleness",
      "to": "context_builder",
      "label": "risk gate"
    },
    {
      "from": "strategy_orchestrator",
      "to": "context_builder",
      "label": "build context"
    },
    {
      "from": "context_builder",
      "to": "market_data_context",
      "label": "wrap state"
    },
    {
      "from": "market_data_context",
      "to": "decision_engine",
      "label": "market data input"
    },
    {
      "from": "decision_engine",
      "to": "strategy_decide",
      "label": "evaluate strategy"
    }
  ],
  "notes": [
    "TradingEngine uses REST tickers/candles and records marks via PriceTickStore.",
    "WebSocket streaming updates runtime_state for orderbook + trade flow context.",
    "Risk mark-staleness checks read LiveRiskManager.last_mark_update timestamps.",
    "EventStore persistence captures mark updates and orderbook/trade summaries.",
    "StrategyOrchestrator consumes runtime_state to build MarketDataContext."
  ],
  "generated_at": "2026-01-15T06:12:04.395728+00:00"
}
