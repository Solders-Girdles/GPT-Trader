# GPT-Trader Alert Runbooks

---
status: current
last-updated: 2026-01-24
---

This document provides Standard Operating Procedures (SOPs) for responding to alerts generated by the GPT-Trader system.

## Quick Reference

| Alert | Severity | Immediate Action |
|-------|----------|------------------|
| Strategy Cycle Error | ERROR | Check logs, verify API connectivity |
| Risk Validation Failed | WARNING | Review position limits, check equity |
| Order Placement Failed | ERROR | Check broker status, verify credentials |
| Heartbeat Missing | CRITICAL | Check if process is alive, restart if needed |
| Stale Prices | WARNING | Check WebSocket connection, verify market hours |

---

## Alert Types

### 1. Strategy Cycle Error

**Severity:** ERROR
**Source:** TradingEngine
**Notification Channel:** Console, Webhook, File

#### Description
The trading engine encountered an unhandled exception during a trading cycle. The engine will continue running and retry on the next cycle.

#### Common Causes
1. **Network timeout** - API calls to Coinbase timed out
2. **Invalid API response** - Unexpected data format from broker
3. **Rate limiting** - Too many API requests
4. **Authentication failure** - Expired or invalid credentials

#### Diagnostic Steps

```bash
# 1. Check the status file for error details
cat status.json | jq '.engine'

# 2. Check recent logs
tail -100 ${COINBASE_TRADER_LOG_DIR:-var/logs}/coinbase_trader.log | grep -i error

# 3. Verify API connectivity
curl -s https://api.coinbase.com/api/v3/brokerage/time

# 4. Check error count trend
cat status.json | jq '.engine.errors_count'
```

#### Resolution

| Root Cause | Action |
|------------|--------|
| Network timeout | Wait and monitor; transient issues resolve automatically |
| Rate limiting | Reduce `interval` in config; add backoff logic |
| Auth failure | Regenerate API keys in Coinbase dashboard |
| Invalid response | Check for API version changes; update client |

#### Escalation
- If errors persist for >5 minutes: Restart the bot
- If errors persist after restart: Check Coinbase status page
- If Coinbase is operational: Escalate to development team

---

### 2. Risk Validation Failed

**Severity:** WARNING
**Source:** TradingEngine
**Notification Channel:** Console, Webhook, File

#### Description
The risk manager blocked a trade because it violated one or more risk constraints.

#### Common Causes
1. **Position limit exceeded** - Would exceed max position size
2. **Daily loss limit** - Daily loss threshold reached
3. **Exposure limit** - Total portfolio exposure too high
4. **Equity too low** - Insufficient equity for trade size

#### Diagnostic Steps

```bash
# 1. Check current positions
cat status.json | jq '.positions'

# 2. Check recent prices and equity estimate
cat status.json | jq '.market'

# 3. Review risk manager config
grep -A 20 "risk:" config/profiles/prod.yaml
```

#### Resolution

| Root Cause | Action |
|------------|--------|
| Position limit | Wait for existing position to close |
| Daily loss limit | No action needed - protection working correctly |
| Exposure limit | Reduce position sizes or add collateral |
| Low equity | Deposit funds or reduce position_fraction |

#### Notes
- Risk validation failures are **expected behavior** - the system is protecting you
- High frequency of risk blocks may indicate strategy needs tuning
- Review blocked trades weekly to optimize parameters

---

### 3. Order Placement Failed

**Severity:** ERROR
**Source:** TradingEngine
**Notification Channel:** Console, Webhook, File

#### Description
An order that passed risk validation failed to execute on the broker.

#### Common Causes
1. **Insufficient funds** - Not enough margin/collateral
2. **Invalid symbol** - Symbol not available or delisted
3. **Market closed** - Attempting to trade outside hours
4. **Order rejected** - Price moved too far (for limit orders)
5. **API error** - Broker-side issue

#### Diagnostic Steps

```bash
# 1. Check account balances
# Via CLI:
gpt-trader account snapshot --profile prod

# 2. Check order history
sqlite3 runtime_data/prod/orders.db "select status, count(*) from orders group by status;"

# 3. Verify symbol is tradeable
uv run python scripts/list_products.py

# 4. Check Coinbase status
curl -s https://status.coinbase.com/api/v2/status.json | jq '.status'
```

#### Resolution

| Root Cause | Action |
|------------|--------|
| Insufficient funds | Deposit collateral or reduce position_fraction |
| Invalid symbol | Update config with correct symbols |
| Market closed | Verify trading hours; adjust schedule |
| API error | Retry automatically; if persistent, contact support |

#### Escalation
- Single failure: Monitor, usually transient
- Repeated failures for same symbol: Check symbol configuration
- All orders failing: Check API credentials, broker status

---

### 4. Heartbeat Missing (Dead Man's Switch)

**Severity:** CRITICAL
**Source:** External monitoring (Healthchecks.io, UptimeRobot)
**Notification Channel:** External service (SMS, PagerDuty)

#### Description
The external dead man's switch has not received a heartbeat ping within the expected interval. The bot may have crashed, frozen, or lost network connectivity.

#### Common Causes
1. **Process crash** - OOM kill, unhandled exception
2. **System freeze** - Deadlock, infinite loop
3. **Network failure** - Cannot reach external ping URL
4. **Resource exhaustion** - Disk full, memory exhausted

#### Diagnostic Steps

```bash
# 1. Check if process is running
pgrep -f "gpt-trader" || echo "Process not found!"

# 2. Check system resources
free -h
df -h

# 3. Check last status update
stat status.json
cat status.json | jq '.timestamp_iso'

# 4. Check system logs for OOM
dmesg | grep -i "killed process"

# 5. Check bot logs for errors
tail -200 ${COINBASE_TRADER_LOG_DIR:-var/logs}/coinbase_trader.log
```

#### Resolution

| Root Cause | Action |
|------------|--------|
| Process not running | Restart: `systemctl restart gpt-trader` |
| OOM killed | Increase memory limit or reduce data retention |
| Disk full | Clean up logs: `journalctl --vacuum-size=100M` |
| Network issue | Check firewall, DNS, proxy settings |
| Deadlock | Kill and restart; report to development team |

#### Restart Procedure

```bash
# 1. Stop the bot gracefully (if possible)
systemctl stop gpt-trader

# 2. Verify stopped
pgrep -f "gpt-trader" && pkill -9 -f "gpt-trader"

# 3. Check for stuck positions (critical!)
cat status.json | jq '.positions'

# 4. Start the bot
systemctl start gpt-trader

# 5. Verify heartbeat resumed
sleep 120
cat status.json | jq '.heartbeat'
```

#### Post-Incident
- Review logs to identify root cause
- If OOM: Consider adding memory monitoring alert
- If crash: File bug report with stack trace

---

### 5. Stale Prices

**Severity:** WARNING
**Source:** StatusReporter health assessment
**Notification Channel:** status.json `health_issues` field

#### Description
Price data has not been updated for longer than the configured threshold (default: 30 seconds).

#### Common Causes
1. **WebSocket disconnection** - Stream connection lost
2. **Market closed** - No trading activity
3. **API issues** - Coinbase data feed problems
4. **Symbol delisted** - Symbol no longer available

#### Diagnostic Steps

```bash
# 1. Check last price update time
cat status.json | jq '.market.last_price_update'

# 2. Check WebSocket status (if applicable)
cat status.json | jq '.engine'

# 3. Manually verify prices are available
curl -s "https://api.coinbase.com/api/v3/brokerage/products/BTC-PERP-USDC/ticker"

# 4. Check if market is open
# Crypto markets are 24/7, but INTX has maintenance windows
```

#### Resolution

| Root Cause | Action |
|------------|--------|
| WebSocket disconnected | Usually auto-reconnects; restart if persistent |
| Market closed/maintenance | Wait for market to reopen |
| Symbol delisted | Update configuration with valid symbols |
| API issues | Check Coinbase status page |

---

## Health Status Interpretation

The `status.json` file provides a comprehensive health snapshot:

```bash
# Quick health check
cat status.json | jq '{healthy, health_issues, uptime: .engine.uptime_seconds}'
```

### Healthy State
```json
{
  "healthy": true,
  "health_issues": []
}
```

### Unhealthy States

| `health_issues` Entry | Meaning | Priority |
|-----------------------|---------|----------|
| "Engine not running" | Trading loop stopped | HIGH |
| "Recent error: ..." | Error in last 5 minutes | MEDIUM |
| "Stale prices (Xs old)" | No price updates | MEDIUM |
| "Heartbeat unhealthy" | Heartbeat service failing | HIGH |

---

## Monitoring Commands

### Quick Status Check
```bash
# One-liner health check
cat status.json | jq -r 'if .healthy then "OK" else "ALERT: " + (.health_issues | join(", ")) end'
```

### Watch Mode
```bash
# Continuously monitor status
watch -n 5 'cat status.json | jq "{healthy, cycle: .engine.cycle_count, errors: .engine.errors_count}"'
```

### Log Monitoring
```bash
# Follow logs with error highlighting
tail -f ${COINBASE_TRADER_LOG_DIR:-var/logs}/coinbase_trader.log | grep --color=always -E "ERROR|WARNING|$"
```

---

## Emergency Procedures

### Emergency Stop

If you need to immediately stop all trading:

```bash
# 1. Stop the bot
systemctl stop gpt-trader

# 2. Verify no orphaned processes
pkill -9 -f "gpt-trader"

# 3. Document current positions for manual closure if needed
cat status.json | jq '.positions' > positions_at_stop.json
```

### Position Recovery After Crash

If the bot crashes with open positions:

1. **Check positions**: `cat status.json | jq '.positions'`
2. **Verify with broker**: `gpt-trader account snapshot --profile prod`
3. **Decide action**:
   - If in profit or small loss: Let bot resume management
   - If significant loss or risk: Consider manual closure
4. **Restart bot**: `systemctl start gpt-trader`

The bot's EventStore will attempt to rehydrate state, but manual verification is recommended after any crash.

---

## Escalation Matrix

| Severity | Response Time | Escalation Path |
|----------|---------------|-----------------|
| INFO | N/A | Log review during business hours |
| WARNING | 1 hour | On-call engineer review |
| ERROR | 15 minutes | On-call engineer action |
| CRITICAL | Immediate | On-call engineer + backup |

---

## Contact Information

| Role | Contact | When to Contact |
|------|---------|-----------------|
| Primary On-Call | [Configure] | All alerts during rotation |
| Backup On-Call | [Configure] | If primary unavailable |
| Development Team | [Configure] | Suspected bugs, feature requests |
| Coinbase Support | support.coinbase.com | Exchange-side issues |

---

## Revision History

| Date | Version | Changes |
|------|---------|---------|
| 2024-11-28 | 1.0 | Initial runbook creation |
