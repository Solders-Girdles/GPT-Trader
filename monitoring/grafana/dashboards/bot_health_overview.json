{
  "title": "Bot Health Overview",
  "tags": [
    "trading-bot",
    "health",
    "overview"
  ],
  "timezone": "browser",
  "schemaVersion": 16,
  "version": 1,
  "refresh": "10s",
  "panels": [
    {
      "id": 1,
      "title": "Bot Uptime",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 0,
        "y": 0
      },
      "targets": [
        {
          "expr": "bot_uptime_seconds{profile=\"production\"}",
          "legendFormat": "Uptime",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "value",
        "graphMode": "none"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "red"
              },
              {
                "value": 60,
                "color": "yellow"
              },
              {
                "value": 300,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "id": 2,
      "title": "Cycle Rate (cycles/min)",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "targets": [
        {
          "expr": "rate(bot_cycle_duration_seconds_count{profile=\"production\"}[5m]) * 60",
          "legendFormat": "Cycles/min",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "value",
        "graphMode": "area"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "cpm",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "red"
              },
              {
                "value": 0.5,
                "color": "yellow"
              },
              {
                "value": 1,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "id": 3,
      "title": "Last Cycle",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 12,
        "y": 0
      },
      "targets": [
        {
          "expr": "time() - (bot_cycle_duration_seconds_count{profile=\"production\"} > 0)",
          "legendFormat": "Seconds ago",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "value",
        "graphMode": "none"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 120,
                "color": "yellow"
              },
              {
                "value": 300,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 4,
      "title": "Background Tasks",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 18,
        "y": 0
      },
      "targets": [
        {
          "expr": "sum(bot_background_tasks{profile=\"production\"})",
          "legendFormat": "Active Tasks",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "value",
        "graphMode": "none"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "yellow"
              },
              {
                "value": 1,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "id": 5,
      "title": "Cycle Duration (p50/p95/p99)",
      "type": "graph",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 4
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, rate(bot_cycle_duration_seconds_bucket{profile=\"production\"}[5m]))",
          "legendFormat": "p50",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, rate(bot_cycle_duration_seconds_bucket{profile=\"production\"}[5m]))",
          "legendFormat": "p95",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.99, rate(bot_cycle_duration_seconds_bucket{profile=\"production\"}[5m]))",
          "legendFormat": "p99",
          "refId": "C"
        }
      ],
      "yaxes": [
        {
          "format": "s",
          "label": "Duration"
        },
        {
          "format": "short"
        }
      ],
      "xaxis": {
        "mode": "time"
      },
      "lines": true,
      "fill": 1,
      "linewidth": 2,
      "nullPointMode": "null"
    },
    {
      "id": 6,
      "title": "Background Tasks by Type",
      "type": "table",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 4
      },
      "targets": [
        {
          "expr": "bot_background_tasks{profile=\"production\"}",
          "format": "table",
          "instant": true,
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Time": true,
              "profile": true,
              "__name__": true
            },
            "renameByName": {
              "task": "Task Name",
              "Value": "Count"
            }
          }
        }
      ],
      "options": {
        "showHeader": true
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto"
          }
        }
      }
    },
    {
      "id": 7,
      "title": "Cycle Duration Distribution",
      "type": "graph",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 12
      },
      "targets": [
        {
          "expr": "rate(bot_cycle_duration_seconds_count{profile=\"production\"}[5m])",
          "legendFormat": "Cycle Rate",
          "refId": "A"
        }
      ],
      "yaxes": [
        {
          "format": "ops",
          "label": "Cycles/sec"
        },
        {
          "format": "short"
        }
      ],
      "xaxis": {
        "mode": "time"
      },
      "lines": true,
      "fill": 1,
      "linewidth": 2,
      "bars": false,
      "nullPointMode": "null",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      }
    },
    {
      "id": 8,
      "title": "Streaming Connection State",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 0,
        "y": 20
      },
      "targets": [
        {
          "expr": "bot_streaming_connection_state{profile=\"production\",stream=\"coinbase_ws\"}",
          "legendFormat": "Connection",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "last"
          ]
        },
        "colorMode": "value",
        "graphMode": "none",
        "textMode": "value"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "red"
              },
              {
                "value": 0.5,
                "color": "yellow"
              },
              {
                "value": 0.9,
                "color": "green"
              }
            ]
          },
          "mappings": [
            {
              "type": "value",
              "options": {
                "0": {
                  "text": "DOWN"
                },
                "1": {
                  "text": "UP"
                }
              }
            }
          ]
        }
      }
    },
    {
      "id": 9,
      "title": "Streaming Heartbeat Lag",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 6,
        "y": 20
      },
      "targets": [
        {
          "expr": "bot_streaming_heartbeat_lag_seconds{profile=\"production\",stream=\"coinbase_ws\"}",
          "legendFormat": "Lag",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "value",
        "graphMode": "area"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 10,
                "color": "yellow"
              },
              {
                "value": 20,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 10,
      "title": "Streaming Reconnect Attempts (5m)",
      "type": "graph",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 20
      },
      "targets": [
        {
          "expr": "increase(bot_streaming_reconnect_total{profile=\"production\",stream=\"coinbase_ws\",status=\"attempt\"}[5m])",
          "legendFormat": "Attempts",
          "refId": "A"
        },
        {
          "expr": "increase(bot_streaming_reconnect_total{profile=\"production\",stream=\"coinbase_ws\",status=\"success\"}[5m])",
          "legendFormat": "Successes",
          "refId": "B"
        }
      ],
      "yaxes": [
        {
          "format": "short",
          "label": "Count"
        },
        {
          "format": "short"
        }
      ],
      "xaxis": {
        "mode": "time"
      },
      "lines": true,
      "fill": 1,
      "linewidth": 2,
      "nullPointMode": "null",
      "legend": {
        "show": true
      }
    }
  ],
  "uid": "bot-health-overview"
}
